version: 1
frontend:
  environment:
    variables:
      NODE_VERSION: "18"
      NPM_CONFIG_PRODUCTION: "false"
      NODE_ENV: "production"
  phases:
    preBuild:
      commands:
        - echo "Installing frontend dependencies..."
        - echo "Node version:"
        - node --version
        - echo "NPM version:"
        - npm --version
        - echo "Setting Node.js version to 18..."
        - nvm use 18
        - echo "Clearing npm cache..."
        - npm cache clean --force
        - echo "Installing dependencies with npm install instead of npm ci..."
        - npm install
    build:
      commands:
        - echo "Building frontend..."
        - echo "Current working directory:"
        - pwd
        - echo "Directory contents:"
        - ls -la
        - echo "Starting build process..."
        - npm run build
        - echo "Build completed successfully"
        - echo "Listing dist directory contents:"
        - ls -la dist/
        - echo "Checking dist directory size:"
        - du -sh dist/
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .npm
